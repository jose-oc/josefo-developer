---
title: Script para que el sistema envíe un correo avisando de la falta de espacio en disco
author: Jose OC
type: post
date: 2014-09-28T22:01:28+00:00
url: /blog/script-para-que-el-sistema-envie-un-correo-avisando-de-la-falta-de-espacio-en-disco/
categories:
  - Linux
  - Terminal
tags:
  - bash
  - linux
  - terminal

---
Éste es el script que uso para que el sistema me envíe un correo avisando de la falta de espacio en disco:

<pre class="lang:sh decode:true " title="Script diskAlert">server:/root/bin # cat diskAlert
#!/bin/sh
# set -x
# Shell script to monitor or watch the disk space
# It will send an email to $ADMIN, if the (free available) percentage of space is &gt;= 90%.
# -------------------------------------------------------------------------
# Set admin email so that you can get email.
ADMIN="xxxxxxx@xxxxx.com"
# set alert level 90% is default
ALERT=95
# Exclude list of unwanted monitoring, if several partions then use "|" to separate the partitions.
# An example: EXCLUDE_LIST="/dev/hdd1|/dev/hdc5"
EXCLUDE_LIST=""
#
#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#
function main_prog() {
while read output;
do
#echo $output
  usep=$(echo $output | awk '{ print $1}' | cut -d'%' -f1)
  partition=$(echo $output | awk '{print $2}')
  if [ $usep -ge $ALERT ] ; then
     echo "Running out of space \"$partition ($usep%)\" on server $(hostname), $(date)" | \
     mail -s "Alert: Almost out of disk space $usep%" $ADMIN
  fi
done
}
if [ "$EXCLUDE_LIST" != "" ] ; then
  df -H | grep -vE "^Filesystem|tmpfs|cdrom|${EXCLUDE_LIST}" | awk '{print $5 " " $6}' | main_prog
else
  df -H | grep -vE "^Filesystem|tmpfs|cdrom" | awk '{print $5 " " $6}' | main_prog
fi
</pre>

Este script lo tengo añadido al cron del root:

<pre class="lang:sh decode:true">server:/root # crontab -l
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.UUb0mA installed on Mon Jun  9 21:23:34 2014)
# (Cronie version 4.2)
00 22 * * * /root/bin/diskAlert
</pre>

&nbsp;