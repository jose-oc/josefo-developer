---
title: Mantener tomcat siempre activo
author: Jose OC
type: post
date: 2014-09-28T21:22:45+00:00
# url: /blog/mantener-tomcat-siempre-activo/
categories:
  - Linux
  - Terminal
tags:
  - bash
  - linux
  - terminal
  - tomcat

---
Hace un tiempo un cliente me llamaba con cierta frecuencia porque su aplicación web J2EE dejaba de funcionar. Cuando me conectaba al servidor comprobaba que el servicio tomcat estaba parado.

Estudiar por qué se paraba es otra historia pero para prevenir que su aplicación estuviera parada durante mucho tiempo decidí usar este script.

Creé un archivo html que sólo contenía la palabra YES en el directorio webapps de tomcat: `isalive.html`

```bash
#!/bin/sh
HOST=127.0.0.1
PORT=8080

#infinite loop
##while [ 1 ]
##do
    #try to access tomcat's page
    RES=`wget -O - -o /dev/null --proxy=off http://${HOST}:${PORT}/examples/isalive.html | awk '{ print $1 }'`
    echo got ${RES}
    #decide on reply
if [ "$RES" = "YES" ]
then
    echo tomcat is responding on $HOST:$PORT
else
    echo tomcat seems to be dead.
    echo Killing...
    for thepin in `ps -Af | grep -v grep | grep tomcat | grep catalina | awk '{ print $2 }'`
    do
        kill -9 ${thepin}
    done
    echo Starting...
    #sudo -u tomcat /usr/local/tomcat/bin/startup.sh
    su - miusuario -c '/opt/apache-tomcat-6.0.37/bin/startup.sh'
fi

##sleep 60
##done
```

El script básicamente se conecta vía http con el comando wget a la página que contiene el texto YES a través de la IP local: 127.0.0.1 y el puerto que tenga tomcat configurado, por defecto es 8080. Compara lo que obtiene de esa página, si es la palabra YES todo va bien, tomcat está corriendo y no necesitamos hacer nada. Si no es así entonces arranca tomcat. En este caso necesitaba indicarle qué usuario debía arrancar tomcat. Recuerda que este script lo ejecuta el root.

Añadí este script al cron para que se ejecutara cada 5 minutos:

```
server:/root # crontab -l
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.UUb0mA installed on Mon Jun  9 21:23:34 2014)
# (Cronie version 4.2)
*/5 * * * * /root/bin/okTomcat.sh
```

Este script lo encontré en un sitio web pero lamentablemente no recuerdo dónde así que no puedo dar la URL.
